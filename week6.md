# 데이터 결과 검증
## 가독성을 챙기기 위한 SQL 스타일 가이드
1. 예약어는 대문자로 작성
  - ex. SELECT, FROM, WHERE 등
2. 컬럼 이름은 snake_case로 작성(단, 일관성이 중요한 것이므로 섞어쓰지만 않으면 됨됨)
```SQL
SELECT
 col1 AS event_status
FROM table
```
3. 명시적 vs 암시적인 이름
- 컬럼의 의미를 한 번 더 생각하게 하는 이름이 아닌 **명시적**인 이름 사용 
  - 특히 AS 쓸 때는 명시적으로 씀
4. 왼쪽 정렬
```SQL
SELECT
 col
FROM table
WHERE 1=1
```
5. 예약어나 컬럼은 한 줄에 하나씩 권장
```text
컬럼 수정할 때 편리
```
6. 쉼표는 컬럼 바로 뒤에

## WITH 구문
⚠️SQL 쿼리를 작성하다 보면 가독성 하락의 문제 발생
-> WITH문을 사용해 쿼리를 정의해서 재사용 가능능
- CTE(Common Table Expression)
- SELECT 구문에 이름을 정해주는 것과 유사
- 쿼리 내 반복적으로 사용 가능

```SQL
WITH name_a AS(
    SELECT
     col
    FROM Table
), name_b AS(
    SELECT
     col2
    FROM Table2
)

SELECT
 col
FROM name_a
```
```text
name_a 와 name_b 는 각각 CTE 이름

name_a는 Table에서 col을 선택
name_b는 Table2에서 col2를 선택
```

## PARTITION
### 장점
- 쿼리 성능 향상
  - 전체 데이터를 스캔하는 것보다 파티션 설정한 곳만 스캔하는 것이 빠름
- 데이터 관리 용이성
  - 특정 일자의 데이터를 모두 변경하거나 삭제해야 하면 파티션 설정해서 삭제
- 비용
  - 파티션에 해당하는 데이터만 스캔하면 비용 감소 

⚠️주의사항
- 인덱스도 파티션별로 적용됨
- 파티셔닝 키 변경 불가 → 설계 초기부터 고려해야 함
- 너무 작은 파티션은 오히려 성능 저하 유발 가능

## 데이터 결과 검증 (Data Result Validation)
### 데이터 결과 검증?

> SQL 쿼리 결과가 **내가 기대한 예상 결과와 일치하는지 확인**하는 과정

- **목적**: 분석 결과의 **정확성**과 **신뢰성 확보**
- **필요성**: 단순한 실수는 누구나 할 수 있지만, 이를 **반복하지 않도록 회고**하고 **예방**하는 마인드셋이 중요

---

### 검증 흐름 (Validation Flow)

1. **문제 정의 확인**
   - 요청 사항을 구체적으로 확인
   - 애매한 요구사항은 다시 물어보기

2. **Input / Output 작성**
   - Input: 사용할 원천 데이터
   - Output: 기대하는 결과 데이터 형식
   - 중간 계산이 필요한 경우 `Input → (중간결과) → Output` 흐름을 상상하며 정리

3. **쿼리 작성**
   - 가독성 확보: 주석, 줄 정리
   - 재활용 가능한 구조

4. **결과 비교**
   - 결과가 예상과 다르면 → 원인 분석
   - 결과가 예상과 일치하면 → 공유 및 종료

---

### 문법

| 목적 | 문법 | 설명 |
|------|------|------|
| 행 수 확인 | `COUNT(*)` | 총 행 개수 확인 |
| 필수값 존재 여부 | `WHERE col IS NULL` | NULL 여부 확인 |
| 중복 여부 | `DISTINCT col` | 고유값 개수 확인 |
| 조건 분기 | `CASE WHEN` / `IF` | 예상대로 동작하는지 확인 |
| 중복과 전체 비교 | `COUNT(DISTINCT col), COUNT(col)` | 고유값 수 vs 전체 수 비교 |

## 데이터 결과 검증 흐름
### 전체 흐름

1. **문제 정의 확인**
   - 요청 내용을 구체적으로 확인
   - 분석 목적과 조건을 명확히 이해

2. **Input / Output 정리**
   - Input: 사용할 원천 데이터
   - Output: 원하는 결과 형태
   - 가능하다면 중간 연산 결과까지 정의  
     → **"Input → (중간결과) → Output"** 구조로 상상

3. **쿼리 작성**
   - 가독성 중요: 들여쓰기, 주석, 일관성 유지

4. **결과 비교**
   - ✅ 예상 결과와 실제 쿼리 결과가 일치하면 완료
   - ❌ 불일치 시 원인 파악 후 수정

---


## 3. 실전 예시 접근법

1. 전체 데이터 구조 파악
2. 검증용 특정 `user_id` 선정
3. Raw 데이터에서 직접 count하여 결과 예상**
4. SQL 쿼리 작성
5. 예상 결과와 쿼리 결과 비교
6. 일치하면 → `user_id` 조건 제거 후 전체 실행
